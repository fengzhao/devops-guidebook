<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x5730;&#x5740;&#x91CD;&#x5B9A;&#x5411;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/server/nginx/rewrite" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/devops-guidebook//linux">Linux</a></span><span><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a></span><span><a href="/devops-guidebook//deploy">部署</a></span><span><a href="/devops-guidebook//code">代码管理</a></span><span><a href="/devops-guidebook//devops">DevOps</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//code">代码管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx">Nginx</a><ul><li><a href="/devops-guidebook//server/nginx"><span>基本概要</span></a></li><li><a href="/devops-guidebook//server/nginx/install"><span>安装教程</span></a></li><li><a href="/devops-guidebook//server/nginx/command-line"><span>命令行指令</span></a></li><li><a href="/devops-guidebook//server/nginx/configuration-grammar"><span>配置语法</span></a></li><li><a href="/devops-guidebook//server/nginx/modules"><span>配置模块</span></a></li><li><a href="/devops-guidebook//server/nginx/static-resource-server"><span>静态资源服务器</span></a></li><li><a href="/devops-guidebook//server/nginx/proxy-service"><span>代理服务器</span></a></li><li><a href="/devops-guidebook//server/nginx/load-balance"><span>负载均衡</span></a></li><li><a href="/devops-guidebook//server/nginx/dynamic-cache"><span>动态缓存</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx/rewrite"><span>地址重定向</span></a></li><li><a href="/devops-guidebook//server/nginx/https-service"><span>HTTPS 服务</span></a></li><li><a href="/devops-guidebook//server/nginx/log"><span>访问日志</span></a></li><li><a href="/devops-guidebook//server/nginx/architect"><span>架构原理</span></a></li><li><a href="/devops-guidebook//server/nginx/practical-configuration"><span>实用配置</span></a></li><li><a href="/devops-guidebook//server/nginx/best-practice"><span>最佳实践</span></a></li></ul></li><li><a href="/devops-guidebook//server/elk">ELK</a><ul><li><a href="/devops-guidebook//server/elk"><span>ELK</span></a></li><li><a href="/devops-guidebook//server/elk/elasticsearch"><span>Elasticsearch</span></a></li><li><a href="/devops-guidebook//server/elk/logstash"><span>Logstash</span></a></li><li><a href="/devops-guidebook//server/elk/filebeat"><span>Filebeat</span></a></li><li><a href="/devops-guidebook//server/elk/kibana"><span>Kibana</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="常用 301 跳转" data-depth="2"><a href="/devops-guidebook//server/nginx/rewrite#常用-301-跳转"><span>常用 301 跳转</span></a></li><li title="跨端适配" data-depth="2"><a href="/devops-guidebook//server/nginx/rewrite#跨端适配"><span>跨端适配</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="地址重定向"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//server/nginx/rewrite#地址重定向"><span class="icon,icon-link"></span></a>地址重定向</h1><p>应用场景：</p><ul><li>URL 访问跳转，支持开发设计<ul><li>页面跳转、兼容性支持、展示效果等</li></ul></li><li>SEO 优化</li><li>维护<ul><li>后台维护、流量转发</li></ul></li><li>安全</li></ul><p>使用方式：</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">rewrite</span><span class="token plain"> </span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain">$ </span><span class="token operator">/</span><span class="token plain">pages</span><span class="token operator">/</span><span class="token plain">maintain</span><span class="token punctuation">.</span><span class="token plain">html </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><table><thead><tr><th align="left">字段</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><code>last</code></td><td align="left">停止 rewrite 检测</td></tr><tr><td align="left"><code>break</code></td><td align="left">停止 rewrite 检测</td></tr><tr><td align="left"><code>redirect</code></td><td align="left">返回 302 临时重定向，地址栏会显示跳转后的地址</td></tr><tr><td align="left"><code>permanent</code></td><td align="left">返回 301 永久重定向，地址栏会显示跳转后的地址（浏览器下次直接访问重定向后的地址）</td></tr></tbody></table><br/><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">root</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">opt</span><span class="token operator">/</span><span class="token plain">app</span><span class="token operator">/</span><span class="token plain">code</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">~</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">break</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">rewrite</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">break</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">test</span><span class="token operator">/</span><span class="token plain"> </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">~</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token plain">last </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">rewrite</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token plain">last </span><span class="token operator">/</span><span class="token plain">test</span><span class="token operator">/</span><span class="token plain"> last</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">test</span><span class="token operator">/</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">default_type</span><span class="token plain"> application</span><span class="token operator">/</span><span class="token plain">json</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token number">200</span><span class="token plain"> </span><span class="token string">&#x27;{&quot;status&quot;: &quot;success&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">~</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token plain">imooc </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#rewrite ^/imooc http://www.imooc.com/ permanent;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#rewrite ^/imooc http://www.imooc.com/ redirect;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>规则优先级：</p><ul><li>执行 server 块的 rewrite 指令</li><li>执行 location 匹配</li><li>执行指定的 location 中的 rewrite</li></ul><h2 id="常用-301-跳转"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//server/nginx/rewrite#常用-301-跳转"><span class="icon,icon-link"></span></a>常用 301 跳转</h2><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 将 domain.com 重定向到 www.domain.com</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">server</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">listen</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">server_name</span><span class="token plain"> domain</span><span class="token punctuation">.</span><span class="token plain">com</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">rewrite</span><span class="token plain"> </span><span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token plain">www</span><span class="token punctuation">.</span><span class="token plain">domain</span><span class="token punctuation">.</span><span class="token plain">com</span><span class="token operator">/</span><span class="token plain">$</span><span class="token number">1</span><span class="token plain"> permanent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">server</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">listen</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">server_name</span><span class="token plain"> www</span><span class="token punctuation">.</span><span class="token plain">domain</span><span class="token punctuation">.</span><span class="token plain">com</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">root</span><span class="token plain"> html</span><span class="token operator">/</span><span class="token plain">brain</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">index</span><span class="token plain"> </span><span class="token keyword">index</span><span class="token punctuation">.</span><span class="token plain">html </span><span class="token keyword">index</span><span class="token punctuation">.</span><span class="token plain">htm</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  access</span><span class="token punctuation">.</span><span class="token plain">log logs</span><span class="token operator">/</span><span class="token plain">brain</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">.</span><span class="token plain">main </span><span class="token keyword">gzip</span><span class="token plain"> buffer</span><span class="token operator">=</span><span class="token number">128</span><span class="token plain">k flush</span><span class="token operator">=</span><span class="token number">5</span><span class="token plain">s</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">error_page</span><span class="token plain"> </span><span class="token number">500</span><span class="token plain"> </span><span class="token number">502</span><span class="token plain"> </span><span class="token number">503</span><span class="token plain"> </span><span class="token number">504</span><span class="token plain"> </span><span class="token operator">/</span><span class="token number">50</span><span class="token plain">x</span><span class="token punctuation">.</span><span class="token plain">html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">/</span><span class="token number">50</span><span class="token plain">x</span><span class="token punctuation">.</span><span class="token plain">html </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">root</span><span class="token plain"> html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="跨端适配"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//server/nginx/rewrite#跨端适配"><span class="icon,icon-link"></span></a>跨端适配</h2><p>Nginx 可以通过内置变量 <code>$http_user_agent</code>，获取到请求客户端的 <code>userAgent</code>，从而知道用户处于移动端还是 PC 端，进而控制重定向到 H5 站还是 PC 站。</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">location</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># 当 userAgent 中检测到移动端设备</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token variable">$http_user_agent</span><span class="token plain"> </span><span class="token operator">~</span><span class="token operator">*</span><span class="token plain"> </span><span class="token string">&#x27;(Android|webOS|iPhone|iPod|BlackBerry)&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">set</span><span class="token plain"> </span><span class="token variable">$mobile_request</span><span class="token plain"> </span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># 则重定向至</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token variable">$mobile_request</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">rewrite</span><span class="token plain"> </span><span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token plain">h5</span><span class="token punctuation">.</span><span class="token plain">example</span><span class="token punctuation">.</span><span class="token plain">com</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/server/nginx/rewrite.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">6/20/2022 09:42:41</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__server__nginx__rewrite.md.js"></script>
  </body>
</html>
