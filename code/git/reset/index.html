<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x64A4;&#x9500; git reset</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/code/git/reset" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/devops-guidebook//linux">Linux</a></span><span><a href="/devops-guidebook//server">服务器</a></span><span><a href="/devops-guidebook//deploy">部署</a></span><span><a aria-current="page" class="active" href="/devops-guidebook//code">代码管理</a></span><span><a href="/devops-guidebook//devops">DevOps</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//code">代码管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/devops-guidebook//code/git">Git</a><ul><li><a href="/devops-guidebook//code/git"><span>概述</span></a></li><li><a href="/devops-guidebook//code/git/config"><span>配置 git config</span></a></li><li><a href="/devops-guidebook//code/git/help"><span>帮助 git help</span></a></li><li><a href="/devops-guidebook//code/git/init"><span>初始化 git init</span></a></li><li><a href="/devops-guidebook//code/git/clone"><span>克隆 git clone</span></a></li><li><a href="/devops-guidebook//code/git/add"><span>添加 git add</span></a></li><li><a href="/devops-guidebook//code/git/status"><span>状态 git status</span></a></li><li><a href="/devops-guidebook//code/git/commit"><span>提交 git commit</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//code/git/reset"><span>撤销 git reset</span></a></li><li><a href="/devops-guidebook//code/git/rm"><span>删除 git rm</span></a></li><li><a href="/devops-guidebook//code/git/mv"><span>移动和重命名 git mv</span></a></li><li><a href="/devops-guidebook//code/git/branch"><span>分支 git branch</span></a></li><li><a href="/devops-guidebook//code/git/checkout"><span>查看 git checkout</span></a></li><li><a href="/devops-guidebook//code/git/merge"><span>合并 git merge</span></a></li><li><a href="/devops-guidebook//code/git/stash"><span>储藏 git stash</span></a></li><li><a href="/devops-guidebook//code/git/tag"><span>标签 git tag</span></a></li><li><a href="/devops-guidebook//code/git/fetch"><span>提取 git fetch</span></a></li><li><a href="/devops-guidebook//code/git/pull"><span>拉取 git pull</span></a></li><li><a href="/devops-guidebook//code/git/push"><span>推送 git push</span></a></li><li><a href="/devops-guidebook//code/git/remote"><span>远程 git remote</span></a></li><li><a href="/devops-guidebook//code/git/log"><span>日志 git log</span></a></li><li><a href="/devops-guidebook//code/git/diff"><span>差异 git diff</span></a></li><li><a href="/devops-guidebook//code/git/rebase"><span>变基 git rebase</span></a></li><li><a href="/devops-guidebook//code/git/revert"><span>还原 git revert</span></a></li><li><a href="/devops-guidebook//code/git/reflog"><span>操作日志 git reflog</span></a></li><li><a href="/devops-guidebook//code/git/cherry-pick"><span>移植 git cherry-pick</span></a></li><li><a href="/devops-guidebook//code/git/cat-file"><span>查询 git cat-file</span></a></li><li><a href="/devops-guidebook//code/git/check-ignore"><span>排除文件 check-ignore</span></a></li><li><a href="/devops-guidebook//code/git/commit-tree"><span>提交对象 commit-tree</span></a></li><li><a href="/devops-guidebook//code/git/count-objects"><span>计算 count-objects</span></a></li><li><a href="/devops-guidebook//code/git/diff-index"><span>差异索引 diff-index</span></a></li><li><a href="/devops-guidebook//code/git/for-each-ref"><span>参考输出 for-each-ref</span></a></li><li><a href="/devops-guidebook//code/git/ls-files"><span>文件信息 ls-files</span></a></li><li><a href="/devops-guidebook//code/git/merge-base"><span>合并祖先 merge-base</span></a></li><li><a href="/devops-guidebook//code/git/read-tree"><span>读入索引 read-tree</span></a></li><li><a href="/devops-guidebook//code/git/rev-list"><span>反序列提交 rev-list</span></a></li><li><a href="/devops-guidebook//code/git/rev-parse"><span>rev-parse</span></a></li><li><a href="/devops-guidebook//code/git/show-ref"><span>show-ref</span></a></li><li><a href="/devops-guidebook//code/git/symbolic-ref"><span>symbolic-ref</span></a></li><li><a href="/devops-guidebook//code/git/update-index"><span>update-index</span></a></li><li><a href="/devops-guidebook//code/git/update-ref"><span>update-ref</span></a></li><li><a href="/devops-guidebook//code/git/verify-pack"><span>verify-pack</span></a></li><li><a href="/devops-guidebook//code/git/write-tree"><span>write-tree</span></a></li><li><a href="/devops-guidebook//code/git/git-flow"><span>工作流</span></a></li><li><a href="/devops-guidebook//code/git/hooks"><span>钩子</span></a></li><li><a href="/devops-guidebook//code/git/extensions"><span>扩展</span></a></li><li><a href="/devops-guidebook//code/git/q&amp;a"><span>Q&amp;A</span></a></li></ul></li><li><a href="/devops-guidebook//code/gitlab">Gitlab</a><ul><li><a href="/devops-guidebook//code/gitlab/gitlab"><span>GitLab</span></a></li><li><a href="/devops-guidebook//code/gitlab/gitlab-flow"><span>GitLab Flow</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="撤销暂存" data-depth="2"><a href="/devops-guidebook//code/git/reset#撤销暂存"><span>撤销暂存</span></a></li><li title="已提交本地需撤回" data-depth="3"><a href="/devops-guidebook//code/git/reset#已提交本地需撤回"><span>已提交本地需撤回</span></a></li><li title="用新更改替换撤回的更改" data-depth="3"><a href="/devops-guidebook//code/git/reset#用新更改替换撤回的更改"><span>用新更改替换撤回的更改</span></a></li><li title="本地提交错误文件" data-depth="3"><a href="/devops-guidebook//code/git/reset#本地提交错误文件"><span>本地提交错误文件</span></a></li><li title="中断工作流程处理" data-depth="2"><a href="/devops-guidebook//code/git/reset#中断工作流程处理"><span>中断工作流程处理</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="撤销-git-reset"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#撤销-git-reset"><span class="icon,icon-link"></span></a>撤销 git reset</h1><blockquote><p>Reset current HEAD to the specified state</p><p>用于将当前 <code>HEAD</code> 复位到指定状态（一般用于撤消之前的一些操作）</p></blockquote><h2 id="撤销暂存"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#撤销暂存"><span class="icon,icon-link"></span></a>撤销暂存</h2><p>相当于对 <code>git add</code> 命令的反向操作。</p><p>和 <code>revert</code> 的区别：<code>reset</code> 命令会抹去某个提交记录 <code>commit id</code> 之后的所有提交 <code>commit</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 撤销暂存区的修改，重新放回工作区</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset </span><span class="token operator">&lt;</span><span class="token plain">file-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退 add 到暂存区里的文件，还原为（HEAD commit 里面该文件的状态）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 会撤销从上次提交之后的一些操作</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset HEAD</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset HEAD -- </span><span class="token operator">&lt;</span><span class="token plain">file-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回滚当前分支的指针到指定提交版本，同时重置暂存区，但工作区不变（默认就是-mixed参数）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset </span><span class="token operator">&lt;</span><span class="token plain">commit-id</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="已提交本地需撤回"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#已提交本地需撤回"><span class="icon,icon-link"></span></a>已提交本地需撤回</h3><p>已经将更改提交 commit 到本地，需要撤回提交。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 语法</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --soft </span><span class="token operator">&lt;</span><span class="token plain">commit-id</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --soft </span><span class="token operator">&lt;</span><span class="token plain">HEAD~n</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 示例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退上次提交 coomit 的修改记录放回暂存区（也就是 add 之后存放区域）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --soft HEAD~1</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退至三个版本之前，只回退了提交的信息，暂存区和工作区与回退之前保持一致</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 如果还要提交，直接 commit 即可</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --soft HEAD~3</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>回退至指定版本</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 回退至指定提交版本</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 先查看提交日志</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> log</span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> commit 2xx</span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> commit 1xx</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退到 1xx</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset 1xx</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="用新更改替换撤回的更改"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#用新更改替换撤回的更改"><span class="icon,icon-link"></span></a>用新更改替换撤回的更改</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 回滚至上个版本，它将重置 HEAD 到另外一个提交记录，并且重置暂存区以便和 HEAD 相匹配，但是也到此为止。工作区不会被更改。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --mixed HEAD^</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退到指定提交版本，但保持暂存区和工作区不变</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --keep </span><span class="token operator">&lt;</span><span class="token plain">commit-id</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>已变更的文件都未添加到暂存区，撤销了 commit 和 add 的操作。</p><h3 id="本地提交错误文件"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#本地提交错误文件"><span class="icon,icon-link"></span></a>本地提交错误文件</h3><p>回到某次提交的状态，修改都会抹掉，所以谨慎使用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 重置暂存区与工作区，与上一次提交保持一致</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --hard</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 回退到指定的提交版本，暂存区和工作区也会与变为指定提交版本一致</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --hard </span><span class="token operator">&lt;</span><span class="token plain">commit-id</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>已追踪文件的变更内容都消失了，撤销了 <code>commit</code> 和 <code>add</code> 的操作，同时撤销了本地已追踪内容的修改；未追踪的内容不会被改变。从上面的效果可以看到，文件的修改都会被撤销。-hard 参数需要谨慎使用。</p><h2 id="中断工作流程处理"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//code/git/reset#中断工作流程处理"><span class="icon,icon-link"></span></a>中断工作流程处理</h2><p>在实际开发中经常出现这样的情形：你正在开发一个大的新功能（工作在分支：<code>feature</code>  中），此时来了一个紧急的 BUG 需要修复，但是目前在工作区中的内容还没有成型，还不足以提交，但是又必须切换的另外的分支去修改 BUG。</p><p>📍 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># you were working in &#x27;feature&#x27; branch</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> checkout feature</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># develop new feature</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> commit -a -m </span><span class="token string">&quot;snapshot WIP&quot;</span><span class="token plain"> 						</span><span class="token comment"># (1)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> checkout master</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># fix bug</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> commit				</span><span class="token comment"># commit with real log</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> checkout feature</span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset --soft HEAD^ 	</span><span class="token comment"># go back to WIP state		# (2)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">git</span><span class="token plain"> reset												</span><span class="token comment"># (3)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol><li>这次属于临时提交，因此随便添加一个临时注释即可</li><li>这次 <code>reset</code> 删除了 <code>WIP commit</code>，并且把工作区设置成提交 WIP 快照之前的状态。</li><li>此时，在索引中依然遗留着“snapshot WIP”提交时所做的未提交变化，<code>git reset</code> 将会清理索引成为尚未提交”<em>snapshot WIP</em>“时的状态便于接下来继续工作。</li></ol></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/code/git/reset.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">6/20/2022 09:47:35</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__code__git__reset.md.js"></script>
  </body>
</html>
